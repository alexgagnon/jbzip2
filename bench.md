# Benchmarks

## Just processing

- `jq -rn --stream 'fromstream(1|truncate_stream(inputs)) | select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv' <file.json>`
- `jm <file.json> | jq 'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv'`
- `jstream -d 1 < `
- `jbzip2 -i <file.json> -j 'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv' -p $'[\n' -s $'\n]' -d $',\n' -b 50000000`

`hyperfine --parameter-list i 1,10,100,1000,10000,100000,1000000,2500000 -r 1 $'jq -rn --stream \'fromstream(1|truncate_stream(inputs)) | select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv\' ~/dev/masters-thesis/data/dumps/{i}.json' $'jstream -d 1 < ~/dev/masters-thesis/data/dumps/{i}.json | jq \'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv\'' $'jm {i}.json | jq \'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv\''`

`hyperfine --export-json results.json --parameter-list i 1,10 -r 1 $'jq -rn --stream \'fromstream(1|truncate_stream(inputs)) | select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv\' ~/dev/masters-thesis/data/dumps/{i}.json' $'jstream -d 1 < ~/dev/masters-thesis/data/dumps/{i}.json | jq \'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv\'' $'./jm ~/dev/masters-thesis/data/dumps/{i}.json | jq \'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv\''`

## Decompression and processing

- `bunzip2 --keep -c <file.bz2> | jstream -d 1 | jq \'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv\''`
- `jbzip2 -i <file.bz2> -j 'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [$id, .] | @tsv' -p $'[\n' -s $'\n]' -d $',\n' -b 5000000'`

`hyperfine -r 5 -L i 1,10,100,1000 -L b 5000000  $'bunzip2 --keep -c ./tests/{i}.json.bz2 | jstream -d 1 | jq \'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [., $id] | @tsv\'' $'NO_PROGRESS_BAR=1 ./target/release/jbzip2 -i ./tests/{i}.json.bz2 -j \'select((.type == "item") and (.labels | has("en")) and (.claims.P31 // [] | map(.mainsnak.datavalue.value.id != "Q13442814") | all)) | (.id|ltrimstr("Q")) as $id | .labels["en"].value, (.aliases["en"] // [] | map(.value))[] | [., $id] | @tsv\' -p \'[\n\' -s \'\n]\' -d \',\n\' -b {b}'`
